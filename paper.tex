\documentclass{article}

\usepackage{pdfcomment}
\usepackage[margin=1in]{geometry}

\newcommand{\note}[2]{\pdfmargincomment[color=yellow,author=#1,open=true]{#2}}
\newcommand{\todo}[2]{\pdfmargincomment[color=red,author=#1,open=true]{#2}}

\title{Reproducibility of HCP pipelines across operating systems}

\author{Lalet Scaria, Lindsay B. Lewis, Najmeh Khalili-Mahani, Alan C. Evans, Tristan Glatard}

\begin{document}

\maketitle

\abstract{This paper is a reproducibility study of the work in~\cite{glasser2015multi}.}

\section{Introduction}

Groenschild \emph{et al.} first identified the effect of operating
systems on Freesurfer
results~\cite{Gronenschild2012}. In~\cite{10.3389/fninf.2015.00012} we
quantified this effect on some of the main neuroimaging pipelines
including several FSL pipelines, CIVET and Freesurfer. In this work we
aim at evaluating this effect on the work in~\cite{glasser2015multi}.

The operating system is defined here as a consistent set of software
packages organized in a trusted repository.

The operating system is not the only part of the computational
environment that may hamper reproducibility. The work
in~\cite{diethelm2012limits} mentions reproducibility issues coming
from parallelization.

Reproducibility has several other aspects, see, e.g.,
\url{https://medium.com/@lorenaabarba/barba-group-reproducibility-syllabus-e3757ee635cf#.ty3zmgd4k}/

\section{Materials and Methods}

\subsection{Dataset}

Data: report on versions and subjects used.

\subsection{Minimal pre-processing pipelines}

Described in~\cite{glasser2013minimal}.

We installed the pipelines in three versions of Linux using Docker
containers. Refer to (immutable) version of containers used. Make sure
the exact same containers are used for all subjects (no rebuild as
rebuild would trigger package update). For each execution, we
monitored the list of packages used with versions.

We integrated the pipelines in CBRAIN through the Boutiques system.

\paragraph{Hardware.} We executed the pipelines on Compute Canada
using the Guillimin cluster of Calcul Qu\'ebec. We monitored the
hardware used (CPU and memory). 

\paragraph{FSL installation.} We developed our own FSL installer to be
able to customize easily the FSL version and build (the script
provided by FSL installs the latest version by default). We used FSL
5.0.6, built for CentOS5 and CentOS6.

\paragraph{Algorithms}
A brief description of the algorithms used in the script for analysis

\paragraph{Softwares and Libraries}
A brief description of the softwares and libraries used

\paragraph{Execution.} The pipeline was launched twice in the same
environment to detect any use of pseudo-random numbers. We
made sure that the results produced by these two executions were
identical.

\paragraph{HCP Pipelines}

For the creation of Docker container contianer the HCP Pipelines, there are a few prerequisites. They are

\begin{itemize}
  \item 64 Bit Operating System (We chose Centos 5, 6 and 7)
  \item FMRIB Software Library(a.k.a FSL) version 5.0.6 (An installation script was developed for this)
  \item Freesurfer version 5.3.0-HCP
  \item Connectome Workbench
\end{itemize}

\paragraph{PreFreeSurfer Installation}
From the base image of the centos versions 5, 6 and 7, we created docker containers containing all the necessary libraries and softwares needed for the PreFreeSurfer Pipelines.A list of software packages installed in the docker container is available at (https://github.com/lalet/Dockerfiles/blob/master/Dockerfile.exec-centos5.fslbuild-centos5). CentOS-5 , yum repos are no longer supported, so we had to bypass the repo url to enable the software installation. Numpy library had to be installed separately after RPM rebuilt command since normal installation of numpy was throwing error. To install FMRIB Library a separate installation script was written (https://github.com/lalet/Dockerfiles/blob/master/myFslInstallerScript.sh) which would install the required FMRIB Library based on the input parameters. HCP pipeline version 3.19.0 is used for the study. Humanconnectome workbenchversion 1.2.3 is also installed in the docker directory. Environment variables needed for the functioning of FMRBI and HCP Pipelines are added later on.
A few scripts are also added to the image. They are,
\begin{itemize}
  \item monitor.sh - For monitoring the hardware details and software library versions
  \item create-execution.sh for keeping the input directories unmodified and thus preventing modification of input files.
  \item checksums.sh - To make sure that the files are not corrupted while transferring or processing the subjects.
  \item command-line-script.sh - For submitting the PreFreeSurfer Pipeline script with the right paramets.
\end{itemize}


\paragraph{FreeSurfer Installation}
Out of the images having PreFreeSurfer and environment variables available in Dockerhub(https://hub.docker.com/u/bigdatalabteam/dashboard/), we installed FreeSurfer. FreeSurfer(ftp://surfer.nmr.mgh.harvard.edu/pub/dist/freesurfer/5.3.0-HCP/freesurfer-Linux-centos4\_x86\_64-stable-pub-v5.3.0-HCP.tar.gz) was used for installation. SetUpFreeSurfer script should be sourced before running the FreeSurferPipelineBatch script. There were a few missing libraries that are added using yum to the base image of the centos since these libraries are used by FreeSurfer Pipeline. The images which are input to the FreeSurfer should be processed using PreFreeSurfer. FreeSurfer needs a license number which is obtained from the FreeSurfer site and it is essential for smooth functioning of FreeSurfer. 

\subsection{Results comparisons}

Describe the scripts that will be written to compare results.

\section{Results}

Show lists of packages used with version. Focus on important
differences (e.g.: python interpreter, gcc if relevant) and explain
why these packages are important.

Show results of the comparison.

\section{Discussion}

Discuss the results.

\section{Conclusion}

Conclude and highlight future work.

\section{Acknowledgments}

CBRAIN team. Compute Canada.

\bibliographystyle{plain}
\bibliography{biblio}

\end{document}
